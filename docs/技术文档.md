# 轴类零件加工时间估算系统 - 技术文档

## 1. 系统架构

### 1.1 总体架构
系统采用B/S架构，主要由以下组件构成:
- Web前端: HTML/CSS/JavaScript
- Web后端: Flask框架
- 图纸分析引擎: ShapeAnalyzer类
- 加工时间计算引擎: che.py

### 1.2 模块结构
```
轴类零件加工时间估算系统
├── app.py              # Flask应用主文件
├── chechuang.py        # 图纸分析引擎
├── che.py              # 加工时间计算引擎
├── templates/          # HTML模板目录
│   └── index.html      # 主界面模板
├── uploads/            # 上传文件存储目录
├── venv/               # Python虚拟环境
└── requirements.txt    # 依赖库列表
```

## 2. 核心模块说明

### 2.1 图纸分析引擎(chechuang.py)
- **ShapeAnalyzer类**: 负责分析工程图纸，提取几何特征
- 主要方法:
  - `_convert_pdf_to_png()`: 将PDF转换为PNG图像
  - `_encode_image()`: 将图像转换为base64编码
  - `analyze_shape()`: 分析图像并返回识别结果
  - `_process_dimension_format()`: 处理尺寸信息格式

### 2.2 加工时间计算引擎(che.py)
- 负责根据几何特征和材料参数计算加工时间
- 主要功能:
  - 车削加工时间计算
  - 磨削加工时间计算
  - 铣削加工时间计算
  - 螺纹加工时间计算
  - 总加工时间汇总

### 2.3 Web应用(app.py)
- 基于Flask框架的Web应用
- 主要路由:
  - `/`: 首页，处理文件上传
  - `/processing`: 处理页面
  - `/check_status`: 检查处理状态
  - `/calculate`: 计算加工时间

## 3. 数据流程

### 3.1 图纸上传流程
1. 用户通过Web界面上传PDF图纸
2. 系统保存文件到uploads目录
3. 启动异步处理任务分析图纸

### 3.2 图纸分析流程
1. 将PDF转换为PNG图像
2. 将图像编码为base64格式
3. 调用AI模型API分析图像
4. 解析API返回的JSON结果
5. 保存分析结果到JSON文件

### 3.3 加工时间计算流程
1. 读取分析结果JSON文件
2. 根据材料类型确定加工参数
3. 计算各工序加工时间
4. 汇总总加工时间
5. 返回计算结果

## 4. API接口说明

### 4.1 内部API
- `/check_status`: 检查图纸分析状态
  - 参数: `filename`
  - 返回: JSON格式状态信息

### 4.2 外部API
- AI模型API
  - 端点: `https://aihubmix.com/v1/chat/completions`
  - 方法: POST
  - 参数: 模型名称、系统提示、用户提示、图像数据
  - 返回: JSON格式分析结果

## 5. 算法说明

### 5.1 车削加工时间计算
```
车削时间 = 基础准备时间 + (粗加工时间*0.8 + 精加工时间*0.2) * 系数
系数 = 1.5 * 直径因子 * 长度因子
直径因子 = 1.0 + (直径 / 100)
长度因子 = 1.0 + (高度 / 200)
```

### 5.2 磨削加工时间计算
```
磨削时间 = 基础准备时间 + (粗磨时间*0.6 + 精磨时间*0.4) * 系数
系数 = 1.2
```

### 5.3 铣削加工时间计算
```
铣削时间 = 基础准备时间 + 槽调整时间 + (粗铣时间 + 精铣时间) * 系数
槽调整时间 = 槽数量 * 60秒
系数 = 1.3
```

### 5.4 螺纹加工时间计算
```
螺纹时间 = 基础准备时间 + (切削次数 * (进给时间 + 快速返回时间)) * 系数
系数 = 1.25
``` 